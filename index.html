<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>忍者寝首討ち ～てっぺん城の殿を打て～</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="gameContainer">
        <!-- タイトル画面 -->
        <div id="titleScreen">
            <h1>忍者寝首討ち</h1>
            <h2>～てっぺん城の殿を打て～</h2>
            <div class="ninja-title">🥷</div>
            <button id="startBtn" class="game-btn">参る！</button>
            <div class="instructions">
                <p>📱 操作方法：</p>
                <p>上下左右タップ：移動</p>
                <p>長押し：息を止めて隠れる</p>
                <p>⌨️ キーボード：</p>
                <p>矢印キー / WASD：移動</p>
                <p>スペースキー：隠れる</p>
                <p>目的：殿様の寝室まで忍び込め！</p>
            </div>
        </div>

        <!-- ゲーム画面 -->
        <div id="gameScreen" style="display: none;">
            <div id="gameInfo">
                <div class="info-item"><span class="icon">🥷</span><span id="score">0</span></div>
                <div class="info-item"><span class="icon">🪜</span><span id="stage">1F</span></div>
                <div class="info-item"><span class="icon">👁️</span><span id="stealth">100%</span></div>
            </div>
            
            <canvas id="gameCanvas"></canvas>

            <!-- スマホ操作ボタン -->
            <div id="mobileControls">
                <div id="directionControls">
                    <button id="upBtn" class="control-button up" title="上">
                        <svg width="40" height="40" viewBox="0 0 40 40" class="icon"><polygon points="20,5 35,30 5,30" fill="#ff6b6b"/></svg>
                    </button>
                    <button id="leftBtn" class="control-button left" title="左">
                        <svg width="40" height="40" viewBox="0 0 40 40" class="icon"><polygon points="5,20 30,5 30,35" fill="#ff6b6b"/></svg>
                    </button>
                    <button id="downBtn" class="control-button down" title="下">
                        <svg width="40" height="40" viewBox="0 0 40 40" class="icon"><polygon points="20,35 5,10 35,10" fill="#4ecdc4"/></svg>
                    </button>
                    <button id="rightBtn" class="control-button right" title="右">
                        <svg width="40" height="40" viewBox="0 0 40 40" class="icon"><polygon points="35,20 10,5 10,35" fill="#4ecdc4"/></svg>
                    </button>
                </div>
                <button id="hideBtn" class="control-button hide-button" title="しゃがむ / 隠れる">
                    <svg width="48" height="48" viewBox="0 0 48 48" class="icon">
                        <circle cx="24" cy="24" r="20" fill="#ff4d4d"/>
                        <rect x="18" y="16" width="12" height="20" fill="#000"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- クリア画面 -->
        <div id="clearScreen" style="display: none;">
            <h1>🎌 見事成敗！ 🎌</h1>
            <svg class="lord-defeated" viewBox="0 0 200 120">
                <rect width="200" height="120" fill="#333"/>
                <circle cx="100" cy="60" r="40" fill="#222"/>
                <rect x="60" y="70" width="80" height="20" fill="#444"/>
                <rect x="95" y="45" width="10" height="10" fill="#fff"/>
            </svg>
            <div id="finalScore">忍度: 0点</div>
            <div id="clearRank">忍者ランク: 見習い</div>
            <button id="restartBtn" class="game-btn">再び参る</button>
        </div>

        <!-- ゲームオーバー画面 -->
        <div id="gameoverScreen" style="display: none;">
            <h1>😱 見つかった！</h1>
            <svg class="caught" viewBox="0 0 200 120">
                <rect width="200" height="120" fill="#550000"/>
                <rect x="70" y="40" width="60" height="60" fill="#222"/>
                <circle cx="90" cy="60" r="8" fill="#ff0000"/>
                <circle cx="110" cy="60" r="8" fill="#ff0000"/>
                <rect x="85" y="75" width="30" height="10" fill="#fff"/>
            </svg>
            <p>「何者だ！！」</p>
            <button id="retryBtn" class="game-btn">再挑戦</button>
        </div>
    </div>

    <!-- 敵とオブジェクトのテンプレート -->
    <div id="enemyTemplates" style="display:none;">
        <svg class="enemy-shadow-guard" viewBox="0 0 48 48" width="48" height="48">
            <circle cx="24" cy="24" r="20" fill="#000"/>
            <circle cx="24" cy="24" r="6" fill="red"/>
            <rect x="34" y="8" width="8" height="32" fill="#777"/>
        </svg>
        <svg class="enemy-bow-ninja" viewBox="0 0 48 48" width="48" height="48">
            <rect x="18" y="12" width="12" height="24" fill="#333"/>
            <path d="M10 24 Q24 0 38 24 Q24 48 10 24" stroke="#999" stroke-width="2" fill="none"/>
        </svg>
        <svg class="enemy-fire-ninja" viewBox="0 0 48 48" width="48" height="48">
            <rect x="16" y="16" width="16" height="16" fill="#111"/>
            <path d="M8 40 L24 8 L40 40 Z" fill="orange"/>
        </svg>
        <svg class="enemy-club-brute" viewBox="0 0 48 48" width="48" height="48">
            <rect x="12" y="8" width="24" height="32" fill="#444"/>
            <rect x="32" y="4" width="8" height="20" fill="#666"/>
        </svg>
        <svg class="enemy-ninja-dog" viewBox="0 0 48 48" width="48" height="48">
            <rect x="8" y="24" width="32" height="12" fill="#555"/>
            <rect x="32" y="20" width="12" height="8" fill="#555"/>
            <rect x="12" y="36" width="8" height="8" fill="#444"/>
            <rect x="28" y="36" width="8" height="8" fill="#444"/>
            <rect x="4" y="28" width="8" height="4" fill="#888"/>
        </svg>
        <svg class="enemy-puppet" viewBox="0 0 48 48" width="48" height="48">
            <circle cx="24" cy="12" r="8" fill="#b8860b"/>
            <rect x="18" y="20" width="12" height="20" fill="#cd853f"/>
            <line x1="12" y1="22" x2="4" y2="32" stroke="#cd853f" stroke-width="4"/>
            <line x1="36" y1="22" x2="44" y2="32" stroke="#cd853f" stroke-width="4"/>
        </svg>
        <svg class="enemy-scout" viewBox="0 0 48 48" width="48" height="48">
            <rect x="20" y="8" width="8" height="32" fill="#222"/>
            <polygon points="24,8 8,40 40,40" fill="#333"/>
            <circle cx="24" cy="16" r="4" fill="#0ff"/>
        </svg>
        <svg class="enemy-chain-ninja" viewBox="0 0 48 48" width="48" height="48">
            <rect x="20" y="12" width="8" height="24" fill="#333"/>
            <path d="M24 12 q12 12 0 24 q-12 -12 0 -24" stroke="#999" stroke-width="4" fill="none"/>
        </svg>
        <svg class="enemy-fox-assassin" viewBox="0 0 48 48" width="48" height="48">
            <polygon points="24,4 32,20 16,20" fill="#fff" stroke="#f00"/>
            <rect x="20" y="20" width="8" height="20" fill="#222"/>
            <rect x="8" y="24" width="8" height="4" fill="#ccc"/>
            <rect x="32" y="24" width="8" height="4" fill="#ccc"/>
        </svg>
        <svg class="enemy-phantom" viewBox="0 0 48 48" width="48" height="48">
            <path d="M8 16 Q24 -4 40 16 L40 40 Q24 44 8 40 Z" fill="rgba(200,200,200,0.5)"/>
            <circle cx="24" cy="20" r="4" fill="#fff"/>
            <circle cx="30" cy="22" r="4" fill="#fff"/>
        </svg>
    </div>

    <div id="objectTemplates" style="display:none;">
        <svg class="bamboo-cluster" viewBox="0 0 48 48" width="48" height="48">
            <rect x="10" y="4" width="6" height="40" fill="#2e8b57"/>
            <rect x="22" y="8" width="6" height="36" fill="#3cb371"/>
            <rect x="34" y="6" width="6" height="38" fill="#2e8b57"/>
        </svg>
        <svg class="shoji-screen" viewBox="0 0 48 48" width="48" height="48">
            <rect x="4" y="4" width="40" height="40" fill="#ddd" stroke="#444"/>
            <path d="M4 20 H44 M4 28 H44 M20 4 V44 M28 4 V44" stroke="#444" stroke-width="2"/>
        </svg>
        <svg class="trap-spike" viewBox="0 0 48 48" width="48" height="48">
            <polygon points="4,44 12,20 20,44" fill="#777"/>
            <polygon points="20,44 28,20 36,44" fill="#555"/>
            <polygon points="36,44 44,20 52,44" fill="#777"/>
        </svg>
        <svg class="roof-tile" viewBox="0 0 48 48" width="48" height="48">
            <path d="M0 32 L24 12 L48 32 Z" fill="#666"/>
            <rect x="0" y="32" width="48" height="8" fill="#555"/>
        </svg>
    </div>

    <!-- 配置用コンテナ -->
    <div id="enemyContainer"></div>
    <div id="objectContainer"></div>

    <script src="script.js"></script>
</body>
</html>
